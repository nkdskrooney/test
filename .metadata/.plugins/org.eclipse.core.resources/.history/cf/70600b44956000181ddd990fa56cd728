package com.internousdev.toolbox.action;

import java.util.Map;

import com.internousdev.toolbox.dao.CartInsertDAO;
import com.internousdev.toolbox.dto.LoginDTO;

public class CartInsertAction {

	public Map<String, Object> session;
	private int itemId;
	private int count;

	public String execute(){
		String result;
		String tempUserId = session.get("temp_user_id").toString();
		String userId = null;
		CartInsertDAO dao = new CartInsertDAO();

		if(session.containsKey("loginUser")){
			LoginDTO loginDTO = (LoginDTO) session.get("loginUser");
			userId = loginDTO.getUserId();
		}


		if(productCount < 6 && productCount>0){
		price = price*productCount;
//		cart_infoテーブルへの入力
		int check = insertCartDAO.insertCart(userId, tempUserId, productId, productCount, price);
		if(check == 0){
			result = ERROR;
		}

		session.put("userId", userId);

		SelectCartInfoDAO dao = new SelectCartInfoDAO();
//		カート情報の取得
		cartList = dao.selectCartInfo(userId, tempUserId);

//		カートの合計金額を算出
		for(int i = 0; i < cartList.size(); i++){
			totalPrice += cartList.get(i).getTotalPrice();
		}
		session.put("cartList", cartList);
		result = SUCCESS;

		}else{
			result = ERROR;
		}
		return result;
	}

	public Map<String, Object> getSession() {
		return session;
	}

	public void setSession(Map<String, Object> session) {
		this.session = session;
	}

	public int getItemId() {
		return itemId;
	}

	public void setItemId(int itemId) {
		this.itemId = itemId;
	}

	public int getCount() {
		return count;
	}

	public void setCount(int count) {
		this.count = count;
	}



}
