package com.internousdev.miamiburger.action;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.apache.struts2.interceptor.SessionAware;

import com.internousdev.miamiburger.dao.InsertCartDAO;
import com.internousdev.miamiburger.dao.SelectCartInfoDAO;
import com.internousdev.miamiburger.dto.CartProductInfoDTO;
import com.internousdev.miamiburger.dto.UserInfoDTO;
import com.opensymphony.xwork2.ActionSupport;

public class InsertCartAction extends ActionSupport implements SessionAware{

	public Map<String, Object> session;
	private int productId;
	private int price;
	private int productCount;
	
	public String execute(){
		String tempUserId = session.get("temp_user_id").toString();
		String userId = null;
		if(session.containsKey("userInfoDTO")){
			UserInfoDTO loginDTO = (UserInfoDTO) session.get("userInfoDTO");
			userId = loginDTO.getUserId();
		}
		InsertCartDAO insertCartDAO = new InsertCartDAO();

		price = price*productCount;
//		cart_infoテーブルへの入力
		insertCartDAO.insertCart(userId, tempUserId, productId, productCount, price);
		
		session.put("userId", userId);

		List<CartProductInfoDTO> cartList = new ArrayList<>();
		SelectCartInfoDAO dao = new SelectCartInfoDAO();
//		カート情報の取得
		cartList = dao.selectCartInfo(userId, tempUserId);

		session.put("cartList", cartList);
		
		return SUCCESS;
	}

	public void setSession(Map<String, Object> session) {
		this.session = session;
	}

	public int getProductId() {
		return productId;
	}

	public void setProductId(int productId) {
		this.productId = productId;
	}

	public int getPrice() {
		return price;
	}

	public void setPrice(int price) {
		this.price = price;
	}

	public int getProductCount() {
		return productCount;
	}

	public void setProductCount(int productCount) {
		this.productCount = productCount;
	}



	
}
